<!DOCTYPE html>
<html lang="ru">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞</title>
   <style>
      body {
         font-family: Arial, sans-serif;
         max-width: 800px;
         margin: 0 auto;
         padding: 20px;
         background-color: #f5f5f5;
      }

      .container {
         background: white;
         padding: 30px;
         border-radius: 10px;
         box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      button {
         background: #007bff;
         color: white;
         border: none;
         padding: 10px 20px;
         border-radius: 5px;
         cursor: pointer;
         margin: 10px 5px;
      }

      button:hover {
         background: #0056b3;
      }

      .success {
         color: green;
         font-weight: bold;
      }

      .error {
         color: red;
         font-weight: bold;
      }

      pre {
         background: #f8f9fa;
         padding: 15px;
         border-radius: 5px;
         overflow-x: auto;
      }
   </style>
</head>

<body>
   <div class="container">
      <h1>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞</h1>
      <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ localStorage –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.</p>

      <div>
         <button onclick="getTestToken()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω</button>
         <button onclick="clearTokens()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã</button>
         <button onclick="showCurrentTokens()">–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã</button>
      </div>

      <div id="result"></div>

      <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
      <ol>
         <li>–ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω"</li>
         <li>–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ, –æ–Ω –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage</li>
         <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –µ—ë</li>
         <li>–¢–µ–ø–µ—Ä—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å</li>
      </ol>

      <h3>–¢–µ–∫—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã –≤ localStorage:</h3>
      <pre id="tokens"></pre>
   </div>

   <script>
      const API_URL = 'http://localhost:3001/api';

      async function getTestToken() {
         const resultDiv = document.getElementById('result');
         resultDiv.innerHTML = '<p>üîÑ –ü–æ–ª—É—á–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω...</p>';

         try {
            const response = await fetch(`${API_URL}/auth/test-token`, {
               method: 'GET',
               headers: {
                  'Content-Type': 'application/json',
               },
            });

            const data = await response.json();

            if (data.success && data.data?.token) {
               // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ localStorage
               localStorage.setItem('extended_token', data.data.token);
               localStorage.setItem('telegram_token', data.data.token);
               localStorage.setItem('authToken', data.data.token);
               localStorage.setItem('token', data.data.token);

               // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
               localStorage.setItem('user', JSON.stringify(data.data.user));

               resultDiv.innerHTML = `
                        <p class="success">‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!</p>
                        <p><strong>–¢–æ–∫–µ–Ω:</strong> ${data.data.token.substring(0, 50)}...</p>
                        <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${data.data.user.firstName} ${data.data.user.lastName}</p>
                    `;

               showCurrentTokens();
            } else {
               resultDiv.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>`;
            }
         } catch (error) {
            resultDiv.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</p>`;
         }
      }

      function clearTokens() {
         localStorage.removeItem('extended_token');
         localStorage.removeItem('telegram_token');
         localStorage.removeItem('authToken');
         localStorage.removeItem('token');
         localStorage.removeItem('user');

         document.getElementById('result').innerHTML = '<p class="success">‚úÖ –í—Å–µ —Ç–æ–∫–µ–Ω—ã –æ—á–∏—â–µ–Ω—ã!</p>';
         showCurrentTokens();
      }

      function showCurrentTokens() {
         const tokensDiv = document.getElementById('tokens');
         const tokens = {
            'extended_token': localStorage.getItem('extended_token'),
            'telegram_token': localStorage.getItem('telegram_token'),
            'authToken': localStorage.getItem('authToken'),
            'token': localStorage.getItem('token'),
            'user': localStorage.getItem('user')
         };

         tokensDiv.textContent = JSON.stringify(tokens, null, 2);
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      showCurrentTokens();
   </script>
</body>

</html>