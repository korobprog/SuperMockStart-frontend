<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Form Test</title>
   <style>
      body {
         font-family: Arial, sans-serif;
         margin: 20px;
      }

      .test-section {
         margin: 20px 0;
         padding: 15px;
         border: 1px solid #ccc;
         border-radius: 5px;
      }

      button {
         padding: 10px 15px;
         margin: 5px;
         background: #007bff;
         color: white;
         border: none;
         border-radius: 3px;
         cursor: pointer;
      }

      button:hover {
         background: #0056b3;
      }

      .result {
         margin-top: 10px;
         padding: 10px;
         background: #f8f9fa;
         border-radius: 3px;
      }

      .success {
         background: #d4edda;
         color: #155724;
      }

      .error {
         background: #f8d7da;
         color: #721c24;
      }
   </style>
</head>

<body>
   <h1>üß™ –¢–µ—Å—Ç —Ñ–æ—Ä–º—ã SuperMock</h1>

   <div class="test-section">
      <h3>1. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞</h3>
      <button onclick="getTestToken()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω</button>
      <div id="tokenResult" class="result"></div>
   </div>

   <div class="test-section">
      <h3>2. –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã</h3>
      <button onclick="submitForm()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É</button>
      <div id="formResult" class="result"></div>
   </div>

   <div class="test-section">
      <h3>3. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã</h3>
      <button onclick="getFormData()">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã</button>
      <div id="getFormResult" class="result"></div>
   </div>

   <div class="test-section">
      <h3>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h3>
      <button onclick="checkLocalStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ localStorage</button>
      <div id="localStorageResult" class="result"></div>
   </div>

   <script>
      let currentToken = null;

      function showResult(elementId, message, isSuccess = true) {
         const element = document.getElementById(elementId);
         element.innerHTML = `<strong>${isSuccess ? '‚úÖ' : '‚ùå'}</strong> ${message}`;
         element.className = `result ${isSuccess ? 'success' : 'error'}`;
      }

      async function getTestToken() {
         try {
            const response = await fetch('/api/auth/test-token');
            const data = await response.json();

            if (data.success) {
               currentToken = data.data.token;
               localStorage.setItem('telegram_token', currentToken);
               showResult('tokenResult', `–¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω: ${currentToken.substring(0, 20)}...`);
            } else {
               showResult('tokenResult', `–û—à–∏–±–∫–∞: ${data.error}`, false);
            }
         } catch (error) {
            showResult('tokenResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
         }
      }

      async function submitForm() {
         try {
            const token = localStorage.getItem('telegram_token') || currentToken;

            if (!token) {
               showResult('formResult', '–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω!', false);
               return;
            }

            const formData = {
               profession: 'frontend-developer',
               country: 'RU',
               experience: '1-3',
               email: 'test@example.com',
               phone: '+7 (999) 123-45-67'
            };

            const response = await fetch('/api/form', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${token}`
               },
               body: JSON.stringify(formData)
            });

            const data = await response.json();

            if (response.ok && data.success) {
               showResult('formResult', `–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data.data)}`);
            } else {
               showResult('formResult', `–û—à–∏–±–∫–∞: ${data.error || response.status}`, false);
            }
         } catch (error) {
            showResult('formResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
         }
      }

      async function getFormData() {
         try {
            const token = localStorage.getItem('telegram_token') || currentToken;

            if (!token) {
               showResult('getFormResult', '–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω!', false);
               return;
            }

            const response = await fetch('/api/form', {
               method: 'GET',
               headers: {
                  'Authorization': `Bearer ${token}`
               }
            });

            const data = await response.json();

            if (response.ok && data.success) {
               showResult('getFormResult', `–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã: ${JSON.stringify(data.data)}`);
            } else {
               showResult('getFormResult', `–û—à–∏–±–∫–∞: ${data.error || response.status}`, false);
            }
         } catch (error) {
            showResult('getFormResult', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, false);
         }
      }

      function checkLocalStorage() {
         const token = localStorage.getItem('telegram_token');
         if (token) {
            showResult('localStorageResult', `–¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${token.substring(0, 20)}...`);
         } else {
            showResult('localStorageResult', '–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage', false);
         }
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.onload = function () {
         getTestToken();
      };
   </script>
</body>

</html>