# Dockerfile для разработки бэкенда
FROM node:20-alpine

# Настраиваем pnpm
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
# Suppress deprecation warnings during build
ENV NPM_CONFIG_LOGLEVEL=error
ENV PNPM_LOG_LEVEL=error
RUN corepack enable

WORKDIR /app

# Копируем файлы зависимостей
COPY package.json pnpm-lock.yaml ./

# Копируем Prisma схему до установки зависимостей
COPY prisma ./prisma

# Устанавливаем зависимости (postinstall скрипт теперь найдет schema.prisma)
RUN pnpm install --frozen-lockfile --silent

# Копируем исходный код
COPY . .

# Открываем порт для разработки
EXPOSE 3001

# Запускаем в режиме разработки
CMD ["pnpm", "run", "dev"] 